<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>项目总体计划展示</title>
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <script src="./js/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="./element_ui/index.css">
    <link rel="stylesheet" href="./element_ui/iconfont/iconfont.css">
    <link rel="stylesheet" href="./css/index.css">
    <script src="./element_ui/vue.js" type="text/javascript"></script>
    <script src="./element_ui/index.js" type="text/javascript"></script>
    <script src="./element_ui/vuex.js" type="text/javascript"></script>
    <script src="./element_ui/store.js" type="text/javascript"></script>
    <script src="./element_ui/vue-resource.js" type="text/javascript"></script>
    <script src="./element_ui/vue-router.js" type="text/javascript"></script>
    <title>项目总体计划</title>
</head>
<body>
    <div id="idbody">
        <div class="ztjh" v-if="shows">
            <div class="select">
                <div class="option">
                    <div class="left">
                        选择查看年度:
                        <select>
                            <option>2019</option>
                            <option>2018</option>
                        </select>
                    </div>
                    <div class="right">
                        <input type="text" value=""><input type="button" value="搜索">
                    </div>
                </div>
            </div>
            <div class="totle">
                <div class="totle_list" v-for="(items,index) in listMessage" @click="listClick(items)">
                    <p>{{items.pName}}</p>
                    <span>计划开始时间：{{items.pStartTime}}</span>
                    <span>项目阶段：{{items.pProjectPhaseId}}</span>
                    <span>计划结束时间：{{items.pEndTime}}</span>
                    <span>总体完成进度：{{items.pProgress}}%</span>
                </div>

            </div>
        </div>

        <div id="project_table" v-else-if="!shows">
            <div class="idbody_title">
                项目总体计划清单
            </div>
            <el-tabs v-model="activeName2" type="card" @tab-click="handleClick">
                <el-tab-pane label="明细计划-需求分析" name="1"></el-tab-pane>
                <el-tab-pane label="明细计划-数据处理" name="2"></el-tab-pane>
                <el-tab-pane label="明细计划-系统开发" name="3"></el-tab-pane>
            </el-tabs>

            <el-table class="tables"
                      border
                      :data="tableData"
                      style="width: 100%">
                <el-table-column
                        align="center"
                        label="任务类"
                >
                    <template slot-scope="scope">
                        {{scope.row.tName}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="任务子类"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.tsName}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="任务项"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.aName}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="计划开始时间"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.apsTime}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="计划完成时间"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.apeTime}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="实际开始时间"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.aasTime}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="实际完成时间"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.aaeTime}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="负责人"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.username}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="完成百分比"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.percentage}}%
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="状态"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.state}}
                    </template>
                </el-table-column>

                <el-table-column
                        align="center"
                        label="成果物是否提交"
                        prop="index"
                >
                    <template slot-scope="scope">
                        {{scope.row.isResult==1?"待提交":"已提交"}}
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </div>


    <script>
        var myHome = new Vue({
            el:"#idbody",
            data:{
                pid:"",
                shows:true,
                listMessage:[],

                /*默认展示的tab切换页*/
                activeName2:"",
                tableData:[],
            },
            mounted:function(){
                var _this=this;
                _this.getListMessage();
            },
            methods:{
                //项目阶段数据转换
                sjzh:function(data){
                    var _this=this;
                    for(var i=0;i<data.length;i++){
                        var items=data[i];
                        if (items.pProjectPhaseId==1) {
                            items.pProjectPhaseId="需求分析"
                        }else if (items.pProjectPhaseId==2) {
                            items.pProjectPhaseId="数据处理"
                        }else if (items.pProjectPhaseId==3) {
                            items.pProjectPhaseId="系统开发"
                        };
                    };
                    return data;
                },

                //获取列表信息
                getListMessage:function(){
                    var _this=this;
                    $.ajax({
                        url:"http://localhost:8080/projectPlan/listAll",
                        data:{
                        },
                        type:"POST",
                        dataType:"json",
                        success:function(res){
                            _this.listMessage=_this.sjzh(res.data);
                        }
                    });
                },

                //点击列表信息
                listClick:function (items) {
                    var _this=this;
                    _this.shows=false;

                    if(items.pProjectPhaseId=="需求分析"){
                        items.pProjectPhaseId="1";
                    }else if(items.pProjectPhaseId=="数据处理"){
                        items.pProjectPhaseId="2";
                    }else if(items.pProjectPhaseId=="系统开发"){
                        items.pProjectPhaseId="3";
                    };
                    _this.activeName2=items.pProjectPhaseId;

                    _this.pid=items.pId;
                    _this.getProject(items);
                },

                /*获取项目总体甲基化清单明细*/
                getProject:function(params){
                    var _this=this;

                    $.ajax({
                        url:"http://localhost:8080/projectPlan/projectPlanList",
                        data:{
                            pId:params.pId,
                            pProjectPhaseId:params.pProjectPhaseId,
                        },
                        type:"POST",
                        dataType:"json",
                        success:function(res){
                            _this.tableData=res.data;
                        }
                    });
                },
                /*点击项目总体计划明细tab*/
                handleClick:function(data){
                    var _this=this;
                    var params={
                        pId:_this.pid,
                        pProjectPhaseId:data.name,
                    };
                    console.log(params)
                    _this.getProject(params);
                },
            },
            updated:function(){
                var _this=this;

            },
        });
    </script>
</body>
</html>